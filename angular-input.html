<div class="form-input-container">

    <!-- SECTION DIVIDER -->
    <div ng-if="field.type=='section'" class="section">
        <span class="section-title">{{field.label}}</span>
        <md-divider class="section-divider"></md-divider>
    </div>
    
    <!-- TEXT FIELD -->
    <div ng-if="field.type=='text'" ng-show="!field.hidden">
        <md-input-container>
            <label>{{field.label}}</label>
            <input
                    type="text"
                    dynamic-directives="field.validators"
                    ng-minlength="{{field.minLength}}"
                    md-maxlength="{{field.maxLength}}"
                    ng-required="field.required && !field.hidden"
                    ng-disabled="field.disabled"
                    name="{{field.name}}"
                    ng-model="modelName[field.name]">
        </md-input-container>

        <span class="form-error"
              ng-show="{{form.name}}.{{field.name}}.$touched && {{form.name}}.{{field.name}}.$invalid">

            <span ng-show="{{form.name}}.{{field.name}}.$error.required">Field is required.</span>
            <span ng-show="{{form.name}}.{{field.name}}.$error.minlength">Field too short. Must be minimum {{field.minLength}} characters.</span>

            <div ng-repeat="validator in field.validators">
                <span data-ng-show="{{form.name}}.{{field.name}}.$error.{{validator.error}}">
                    {{validator.message}}
                </span>
            </div>
        </span>
    </div>
    
    <!-- TEXT AREA FIELD -->
    <div ng-if="field.type=='textarea'" ng-show="!field.hidden" class="textarea">
        <md-input-container>
            <label>{{field.label}}</label>
            <textarea
                    dynamic-directives="field.validators"
                    ng-minlength="{{field.minLength}}"
                    md-maxlength="{{field.maxLength}}"
                    ng-required="field.required && !field.hidden"
                    name="{{field.name}}"
                    ng-model="modelName[field.name]"></textarea>
        </md-input-container>

        <span class="form-error"
              ng-show="{{form.name}}.{{field.name}}.$touched && {{form.name}}.{{field.name}}.$invalid">

            <span ng-show="{{form.name}}.{{field.name}}.$error.required">Field is required.</span>
            <span ng-show="{{form.name}}.{{field.name}}.$error.minlength">Field too short. Must be minimum {{field.minLength}} characters.</span>

            <div ng-repeat="validator in field.validators">
                <span data-ng-show="{{form.name}}.{{field.name}}.$error.{{validator.error}}">
                    {{validator.message}}
                </span>
            </div>
        </span>
    </div>

    <!-- NUMBER FIELD -->
    <div ng-if="field.type=='number'">
        <md-input-container>
            <label>{{field.label}}</label>
            <input
                    type="number"
                    dynamic-directives="field.validators"
                    ng-minlength="{{field.minLength}}"
                    ng-required="field.required"
                    ng-disabled="field.disabled"
                    name="{{field.name}}"
                    ng-model="modelName[field.name]">
        </md-input-container>

        <span class="form-error"
              ng-show="{{form.name}}.{{field.name}}.$touched && {{form.name}}.{{field.name}}.$invalid">

            <span ng-show="{{form.name}}.{{field.name}}.$error.required">Field is required.</span>
            <span ng-show="{{form.name}}.{{field.name}}.$error.number">Invalid field type, should be a number.</span>
            <span ng-show="{{form.name}}.{{field.name}}.$error.minlength">Number too short. Must be minimum {{field.minLength}} characters.</span>

            <div ng-repeat="validator in field.validators">
                <span data-ng-show="{{form.name}}.{{field.name}}.$error.{{validator.error}}">
                    {{validator.message}}
                </span>
            </div>
        </span>
    </div>

    <!-- DATE FIELD -->
    <div ng-if="field.type=='date'">
        <md-input-container>
            <label>{{field.label}}</label>
            <input
                    type="date"
                    dynamic-directives="field.validators"
                    ng-required="field.required"
                    ng-disabled="field.disabled"
                    name="{{field.name}}"
                    ng-model="modelName[field.name]">
        </md-input-container>

        <span class="form-error"
              ng-show="{{form.name}}.{{field.name}}.$touched && {{form.name}}.{{field.name}}.$invalid">

            <span ng-show="{{form.name}}.{{field.name}}.$error.required">Date is required.</span>

            <div ng-repeat="validator in field.validators">
                <span data-ng-show="{{form.name}}.{{field.name}}.$error.{{validator.error}}">
                    {{validator.message}}
                </span>
            </div>
        </span>
    </div>

    <!-- EMAIL FIELD -->
    <div ng-if="field.type=='email'">
        <md-input-container >
            <label>{{field.label}}</label>
            <input
                    type="email"
                    dynamic-directives="field.validators"
                    ng-required="field.required"
                    ng-disabled="field.disabled"
                    name="{{field.name}}"
                    ng-model="modelName[field.name]">
        </md-input-container>

        <span class="form-error"
              ng-show="{{form.name}}.{{field.name}}.$touched && {{form.name}}.{{field.name}}.$invalid">

            <span ng-show="{{form.name}}.{{field.name}}.$error.required">Email is required.</span>
            <span ng-show="{{form.name}}.{{field.name}}.$error.email">Invalid email address.</span>

            <div ng-repeat="validator in field.validators">
                <span data-ng-show="{{form.name}}.{{field.name}}.$error.{{validator.error}}">
                    {{validator.message}}
                </span>
            </div>
        </span>
    </div>


    <!-- PASSWORD FIELD -->
    <div ng-if="field.type=='password'">
        <md-input-container>
            <label>{{field.label}}</label>
            <input
                    type="password"
                    dynamic-directives="field.validators"
                    ng-minlength="{{field.minLength}}"
                    ng-required="field.required"
                    ng-disabled="field.disabled"
                    name="{{field.name}}"
                    ng-model="modelName[field.name]">
        </md-input-container>

        <span class="form-error"
              ng-show="{{form.name}}.{{field.name}}.$touched && {{form.name}}.{{field.name}}.$invalid">

            <span ng-show="{{form.name}}.{{field.name}}.$error.required">Password is required.</span>
            <span ng-show="{{form.name}}.{{field.name}}.$error.minlength">Password too short. Must be minimum {{field.minLength}} characters.</span>

            <div ng-repeat="validator in field.validators">
                <span data-ng-show="{{form.name}}.{{field.name}}.$error.{{validator.error}}">
                    {{validator.message}}
                </span>
            </div>
        </span>
    </div>


    <!-- SELECT FIELD -->
    <div ng-if="field.type=='select'">
        <md-input-container ng-if="!field.multiple">
            <md-select-label>{{field.label}}</md-select-label>
            <md-select
                    placeholder="{{field.label}}"
                    dynamic-directives="field.validators"
                    ng-required="field.required"
                    ng-model="modelName[field.name]">
                <md-option ng-repeat="option in filtered(field.options) track by option.id" ng-value="option.id" class="form-styled">{{option.name}}</md-option>
            </md-select>
        </md-input-container>
        <md-input-container ng-if="field.multiple">
            <md-select-label>{{field.label}}</md-select-label>
            <md-select
                    placeholder="{{field.label}}"
                    dynamic-directives="field.validators"
                    ng-required="field.required"
                    multiple=true
                    ng-model="modelName[field.name]">
                <md-option ng-repeat="option in filtered(field.options) track by option.id" ng-value="option.id" class="form-styled">{{option.name}}</md-option>
            </md-select>
        </md-input-container>
    </div>


    <!-- RADIO FIELD -->
    <div ng-if="field.type=='radio'">
        <md-input-container>
            <md-radio-group
                    dynamic-directives="field.validators"
                    ng-required="field.required"
                    ng-disabled="field.disabled"
                    name="{{field.name}}"
                    ng-model="modelName[field.name]">
                <md-radio-button ng-repeat="option in field.options"
                                 ng-value="option.id">
                    {{option.name}}
                </md-radio-button>
            </md-radio-group>
        </md-input-container>

        <span class="form-error"
              ng-show="{{form.name}}.{{field.name}}.$touched && {{form.name}}.{{field.name}}.$invalid">

            <span ng-show="{{form.name}}.{{field.name}}.$error.required">Must select an option.</span>

            <div ng-repeat="validator in field.validators">
                <span data-ng-show="{{form.name}}.{{field.name}}.$error.{{validator.error}}">
                    {{validator.message}}
                </span>
            </div>
        </span>
    </div>


    <!-- CHECKBOX -->
    <div ng-if="field.type=='checkbox'">
        <md-checkbox
                class="md-primary"
                dynamic-directives="field.validators"
                ng-disabled="field.disabled"
                name="{{field.name}}"
                ng-model="modelName[field.name]">
            {{field.label}}
        </md-checkbox>
    </div>
    
    <!-- SORTEDINPUTLIST -->
    <div ng-if="field.type=='sortedinputlist'" class="sortedinputlist" ng-init="form = makeForSIL(field.inputs)">
        <!-- TODO Add validations like max/min items -->
        <md-card>
          <div layout="row" layout-align="start center">
            <small layout-padding flex>{{field.label}}</small>
            <div flex=20 layout="row" layout-align="end center">
              <md-button class="md-icon-button big-icon-button" aria-label="Add" type="button" ng-click="addSI(modelName[field.name])"><i class="mdi mdi-plus-box"></i></md-button>
            </div>
          </div>
          <md-divider></md-divider>

          <md-content layout-padding ng-init="modelName[field.name] = modelName[field.name]?modelName[field.name]: []">
            <div ng-repeat="item in modelName[field.name]" layout="row">
              <div flex><dn-form form=form dn-model=item></dn-form></div>
              <div flex=20 layout="row" class="si-action-buttons">
                <md-button type="button" aria-label="Move Up" ng-click="moveUpSI(modelName[field.name], $index)" flex><i class="mdi mdi-arrow-up-bold"></i></md-button>
                <md-button type="button" aria-label="Move Down" ng-click="moveDownSI(modelName[field.name], $index)" flex><i class="mdi mdi-arrow-down-bold"></i></md-button>
                <md-button type="button" aria-label="Delete" ng-click="removeSI(modelName[field.name], $index)" flex><i class="mdi mdi-delete"></i></md-button>
              </div>
            </div>
          </md-content>
        </md-card>
    </div>
    
    <!-- CHIPS -->
    <div ng-if="field.type=='chips'" class="chips" ng-init="!modelName[field.name]?modelName[field.name] = []:'hello lol'">
        <md-chips 
            ng-model="modelName[field.name]" 
            name="{{field.name}}"
            placeholder="{{field.label}}"
            secondary-placeholder="{{field.label}}">
          <md-chip-template>
            <strong>{{$chip}}</strong>
          </md-chip-template>
        </md-chips>
    </div>

    <!-- SUBMIT BUTTON -->
    <div ng-if="field.type=='submit'">
    <!-- TODO Check validation of child forms too! -->
        <md-button
                class="md-raised md-primary"
                ng-disabled="{{form.name}}.$invalid || {{form.name}}.$pristine"
                name="{{field.name}}">
            {{field.label}}
        </md-button>
    </div>
</div>
